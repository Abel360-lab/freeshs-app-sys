{% load i18n %}
{% get_current_language as LANGUAGE_CODE %}

<div class="language-switcher dropdown">
    <button class="btn btn-outline-secondary dropdown-toggle" type="button" 
            id="languageDropdown" data-bs-toggle="dropdown" aria-expanded="false">
        <i class="fas fa-globe me-2"></i>
        <span class="current-language-name">
            {% if LANGUAGE_CODE == 'en' %}🇺🇸 English
            {% elif LANGUAGE_CODE == 'ak' %}🇬🇭 Akan
            {% elif LANGUAGE_CODE == 'ee' %}🇬🇭 Ewe
            {% elif LANGUAGE_CODE == 'ga' %}🇬🇭 Ga
            {% elif LANGUAGE_CODE == 'ha' %}🇬🇭 Hausa
            {% elif LANGUAGE_CODE == 'tw' %}🇬🇭 Twi
            {% elif LANGUAGE_CODE == 'fr' %}🇫🇷 Français
            {% elif LANGUAGE_CODE == 'es' %}🇪🇸 Español
            {% elif LANGUAGE_CODE == 'de' %}🇩🇪 Deutsch
            {% elif LANGUAGE_CODE == 'it' %}🇮🇹 Italiano
            {% elif LANGUAGE_CODE == 'pt' %}🇵🇹 Português
            {% elif LANGUAGE_CODE == 'ar' %}🇸🇦 العربية
            {% elif LANGUAGE_CODE == 'zh' %}🇨🇳 中文
            {% elif LANGUAGE_CODE == 'ja' %}🇯🇵 日本語
            {% elif LANGUAGE_CODE == 'ko' %}🇰🇷 한국어
            {% elif LANGUAGE_CODE == 'ru' %}🇷🇺 Русский
            {% elif LANGUAGE_CODE == 'hi' %}🇮🇳 हिन्दी
            {% elif LANGUAGE_CODE == 'ur' %}🇵🇰 اردو
            {% else %}🇺🇸 English{% endif %}
        </span>
    </button>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="languageDropdown">
        <!-- Ghanaian Languages -->
        <li><h6 class="dropdown-header">🇬🇭 Ghanaian Languages</h6></li>
        
        <li><a href="#" class="dropdown-item language-option {% if LANGUAGE_CODE == 'en' %}active{% endif %}" data-lang="en">🇺🇸 English</a></li>
        <li><a href="#" class="dropdown-item language-option {% if LANGUAGE_CODE == 'ak' %}active{% endif %}" data-lang="ak">🇬🇭 Akan</a></li>
        <li><a href="#" class="dropdown-item language-option {% if LANGUAGE_CODE == 'tw' %}active{% endif %}" data-lang="tw">🇬🇭 Twi</a></li>
        <li><a href="#" class="dropdown-item language-option {% if LANGUAGE_CODE == 'ee' %}active{% endif %}" data-lang="ee">🇬🇭 Ewe</a></li>
        <li><a href="#" class="dropdown-item language-option {% if LANGUAGE_CODE == 'ga' %}active{% endif %}" data-lang="ga">🇬🇭 Ga</a></li>
        <li><a href="#" class="dropdown-item language-option {% if LANGUAGE_CODE == 'ha' %}active{% endif %}" data-lang="ha">🇬🇭 Hausa</a></li>
        
        <!-- International Languages -->
        <li><hr class="dropdown-divider"></li>
        <li><h6 class="dropdown-header">🌍 International Languages</h6></li>
        
        <li><a href="#" class="dropdown-item language-option {% if LANGUAGE_CODE == 'fr' %}active{% endif %}" data-lang="fr">🇫🇷 Français</a></li>
        <li><a href="#" class="dropdown-item language-option {% if LANGUAGE_CODE == 'es' %}active{% endif %}" data-lang="es">🇪🇸 Español</a></li>
        <li><a href="#" class="dropdown-item language-option {% if LANGUAGE_CODE == 'de' %}active{% endif %}" data-lang="de">🇩🇪 Deutsch</a></li>
        <li><a href="#" class="dropdown-item language-option {% if LANGUAGE_CODE == 'it' %}active{% endif %}" data-lang="it">🇮🇹 Italiano</a></li>
        <li><a href="#" class="dropdown-item language-option {% if LANGUAGE_CODE == 'pt' %}active{% endif %}" data-lang="pt">🇵🇹 Português</a></li>
        <li><a href="#" class="dropdown-item language-option {% if LANGUAGE_CODE == 'ar' %}active{% endif %}" data-lang="ar">🇸🇦 العربية</a></li>
        <li><a href="#" class="dropdown-item language-option {% if LANGUAGE_CODE == 'zh' %}active{% endif %}" data-lang="zh">🇨🇳 中文</a></li>
        <li><a href="#" class="dropdown-item language-option {% if LANGUAGE_CODE == 'ja' %}active{% endif %}" data-lang="ja">🇯🇵 日本語</a></li>
        <li><a href="#" class="dropdown-item language-option {% if LANGUAGE_CODE == 'ko' %}active{% endif %}" data-lang="ko">🇰🇷 한국어</a></li>
        <li><a href="#" class="dropdown-item language-option {% if LANGUAGE_CODE == 'ru' %}active{% endif %}" data-lang="ru">🇷🇺 Русский</a></li>
        <li><a href="#" class="dropdown-item language-option {% if LANGUAGE_CODE == 'hi' %}active{% endif %}" data-lang="hi">🇮🇳 हिन्दी</a></li>
        <li><a href="#" class="dropdown-item language-option {% if LANGUAGE_CODE == 'ur' %}active{% endif %}" data-lang="ur">🇵🇰 اردو</a></li>
    </ul>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Handle language option clicks
    document.querySelectorAll('.language-option').forEach(function(option) {
        option.addEventListener('click', function(e) {
            e.preventDefault();
            
            // Get the selected language
            var selectedLang = this.getAttribute('data-lang');
            
            // Get current URL and remove language prefix if present
            var currentUrl = window.location.pathname;
            var currentLang = '{{ LANGUAGE_CODE }}';
            
            // Remove language prefix from current URL if it exists
            if (currentLang !== 'en' && currentUrl.startsWith('/' + currentLang + '/')) {
                currentUrl = currentUrl.substring(currentLang.length + 1);
            } else if (currentLang !== 'en' && currentUrl.startsWith('/' + currentLang)) {
                currentUrl = currentUrl.substring(currentLang.length);
            }
            
            // Ensure URL starts with /
            if (!currentUrl.startsWith('/')) {
                currentUrl = '/' + currentUrl;
            }
            
            // Create form and submit
            var form = document.createElement('form');
            form.method = 'POST';
            form.action = '{% url "set_language" %}';
            
            // Add CSRF token
            var csrfToken = document.querySelector('[name=csrfmiddlewaretoken]');
            if (csrfToken) {
                var csrfInput = document.createElement('input');
                csrfInput.type = 'hidden';
                csrfInput.name = 'csrfmiddlewaretoken';
                csrfInput.value = csrfToken.value;
                form.appendChild(csrfInput);
            }
            
            // Add language input
            var langInput = document.createElement('input');
            langInput.type = 'hidden';
            langInput.name = 'language';
            langInput.value = selectedLang;
            form.appendChild(langInput);
            
            // Add next input
            var nextInput = document.createElement('input');
            nextInput.type = 'hidden';
            nextInput.name = 'next';
            nextInput.value = currentUrl;
            form.appendChild(nextInput);
            
            // Submit form
            document.body.appendChild(form);
            form.submit();
        });
    });
});
</script>

<style>
.language-switcher .dropdown-item {
    transition: all 0.3s ease;
}

.language-switcher .dropdown-item:hover {
    background-color: var(--primary-color, #007bff);
    color: white;
}

.language-switcher .dropdown-item.active {
    background-color: var(--primary-color, #007bff);
    color: white;
}

.flag-icon {
    width: 16px;
    height: 12px;
    display: inline-block;
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
}

.flag-icon-us {
    background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAyNCAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjI0IiBoZWlnaHQ9IjE2IiBmaWxsPSIjRkYwMDAwIi8+CjxwYXRoIGQ9Ik0wIDBoMjR2MTZoLTI0eiIgZmlsbD0iIzAwMDAwMCIvPgo8L3N2Zz4K');
}

.flag-icon-gh {
    background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAyNCAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjI0IiBoZWlnaHQ9IjE2IiBmaWxsPSIjRkYwMDAwIi8+CjxwYXRoIGQ9Ik0wIDBoMjR2MTZoLTI0eiIgZmlsbD0iIzAwMDAwMCIvPgo8L3N2Zz4K');
}
</style>
